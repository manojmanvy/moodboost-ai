<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MoodBoost AI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=Quicksand:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0; min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 44%, #0f3460 99%);
      animation: bgmove 11s linear infinite alternate;
      font-family: 'Quicksand', 'Baloo 2', Arial, sans-serif;
      position: relative; overflow-x: hidden; color: #e0e0e0;
    }
    @keyframes bgmove {
      0% {background-position: 0 0;}
      100% {background-position: 55vw 59vh;}
    }
    .shape1,.shape2,.shape3,.shape4 {
      position: fixed; opacity: 0.15; pointer-events:none; z-index:0;
    }
    .shape1 {left:1vw;top:8vh;width:120px;height:120px;border-radius:60px 60px 50% 80%;background:#533483;}
    .shape2 {right:7vw;top:6vh;width:110px;height:90px;border-radius:70% 40% 80% 70%;background:#3d5a80;}
    .shape3 {left:13vw;bottom:7vh;width:130px;height:70px;border-radius:55% 65% 90% 80%;background:#293241;}
    .shape4 {right:15vw;bottom:4vh;width:110px;height:62px;border-radius:65% 50% 85% 85%;background:#3e4a61;}
    .glass {
      width: 415px; max-width: 97vw;
      margin: 40px auto 0 auto; padding: 0 1.7em 2em 1.7em;
      background: rgba(30,30,45,0.85);
      box-shadow: 0 6px 32px 8px rgba(0,0,0,0.6);
      border-radius: 28px; overflow: hidden; position: relative; z-index:2;
      backdrop-filter: blur(14px);
      border: 2.2px solid rgba(80,80,120,0.3);
      color: #e0e0e0;
    }
    .header-unique {
      font-family:'Baloo 2',cursive; font-size:2.11em;color:#7c5cde;
      text-shadow:0 5px 15px rgba(124,92,222,0.4),0 2px 0 rgba(255,255,255,0.1);
      background: linear-gradient(93deg,#a78bfa 26%,#60a5fa 56%,#fbbf24 100%);
      -webkit-background-clip: text; background-clip:text;
      -webkit-text-fill-color: transparent; font-weight:900;
      margin:1.3em 0 0.45em 0; letter-spacing:0.05em;
    }
    .user-info {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 12px; font-size: 0.95em; color: #c0c0c0;
    }
    .logout-btn {
      background: #dc2626; color: white; border: none;
      padding: 6px 16px; border-radius: 8px; cursor: pointer;
      font-weight: 600; font-size: 0.9em;
    }
    .logout-btn:hover { background: #b91c1c; }
    .subtext {margin-top:-0.3em;margin-bottom:1.2em;font-size:1.05em;color:#9ca3af;}
    .section-box {
      margin-bottom: 18px;
      background: rgba(50,50,80,0.4);
      border-radius: 13px;
      box-shadow:0 2px 12px rgba(0,0,0,0.3);
      border: 1.3px solid rgba(100,100,150,0.2);
      padding: 17px 13px 12px 13px;
    }
    .bubble-box {
      background:linear-gradient(120deg,rgba(60,60,90,0.6) 16%,rgba(40,60,80,0.6) 100%);
      border-radius:16px;padding:9px 14px;margin-bottom:8px;
      box-shadow:0 2px 12px rgba(0,0,0,0.3); text-align:left;
    }
    .chat-you { color:#a78bfa;font-weight:800; }
    .chat-ai { color:#60a5fa;font-weight:600;}
    .input-row {display:flex;}
    .input-row input {
      flex:1; padding:11px 13px; border-radius:13px 0 0 13px;
      border: 2.7px solid rgba(100,100,150,0.3); font-size:1.08em;outline:none;
      background:rgba(30,30,50,0.8);color:#e0e0e0;
      box-shadow:0 1.2px 5px rgba(0,0,0,0.3);
      border-right:1.3px solid rgba(120,120,180,0.3);
    }
    .input-row input:focus {
      border-color: #7c5cde; background: rgba(40,40,60,0.9); color: #f0f0f0;
    }
    .input-row button{
      padding:10px 23px; border:none;
      background: linear-gradient(90deg, #7c5cde 0%,#60a5fa 100%);
      color:#fff; font-weight:700;
      border-radius:0 13px 13px 0;  cursor:pointer;
      box-shadow:0 1.2px 10px rgba(124,92,222,0.4);
      font-size:1.12em; transition: filter 0.22s;
    }
    .input-row button:hover{filter:brightness(1.2);}
    h3 {margin:21px 0 9px 0;font-weight:700;color:#60a5fa;font-size:1.12em;letter-spacing:0.09em;}
    #interest-input,#mood-input {
      width: 65%; padding:9px; margin-right:7px;
      border: 2.2px solid rgba(100,100,150,0.3);
      background:rgba(30,30,50,0.8);color:#e0e0e0;
    }
    #career-result,#music-result,#motivational-quote {
      margin-top:10px;min-height:25px;
      color:#a78bfa;font-weight:700;letter-spacing:0.03em;
      background:rgba(50,50,80,0.6);
      display:inline-block; border-radius:7px;
      padding: 9px 11px 7px 11px; font-size:1.09em;
      box-shadow:0 2px 7px rgba(0,0,0,0.3);
    }
    #music-result ul{margin:6px 0 0 0;padding-left:17px;}
    #music-result li {
      font-size:1.01em; color:#60a5fa;margin-bottom:4px;
      font-weight:700;letter-spacing:0.02em;
    }
    #motivational-quote { background:rgba(60,60,100,0.5);}
    #support-result {
      margin-top:15px;
      background:rgba(60,60,100,0.5);
      padding:15px;
      border-radius:10px;
      text-align:left;
      box-shadow:0 2px 7px rgba(0,0,0,0.3);
    }
    #support-result p {
      font-weight:700;
      color:#fbbf24;
      font-size:1.1em;
      margin-bottom:10px;
    }
    #support-result ul {
      margin:0;
      padding-left:20px;
      color:#60a5fa;
    }
    #support-result li {
      margin-bottom:5px;
    }
    .history-item {
      background: rgba(50,50,80,0.5); padding: 10px; border-radius: 8px;
      margin-bottom: 8px; font-size: 0.95em;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
    .history-item strong { color: #a78bfa; }
    .history-time { font-size: 0.85em; color: #6b7280; }
    @media (max-width:500px){
      .glass{width:99vw;padding:0 2vw 2.4vw 2vw;}
      #interest-input,#mood-input {width:52%;}
    }
    .icon {font-size:1.13em;margin-right:6px;vertical-align:-1px;}
    .motiv-btn {
      cursor:pointer; padding:13px 34px; border-radius:21px;
      background:#7c5cde; font-weight:700; border:none;
      color:#fff; box-shadow:0 2.5px 11px rgba(124,92,222,0.4);
      font-size:1.09em; letter-spacing:0.04em;
    }
    .motiv-btn:hover {background:#6d4fc7;}
    #situation-select {
      width:100%; padding:10px; border-radius:10px; 
      border:2px solid rgba(100,100,150,0.3); font-size:1em; margin-bottom:10px; 
      background:rgba(30,30,50,0.8); color:#e0e0e0;
    }
  </style>
</head>
<body>
  <div class="shape1"></div>
  <div class="shape2"></div>
  <div class="shape3"></div>
  <div class="shape4"></div>
  <div class="glass">
    <div class="user-info">
      <span id="welcome-msg">Welcome, <strong id="username-display">Guest</strong>!</span>
      <button class="logout-btn" onclick="logout()" style="display:none;" id="logout-btn">Logout</button>
    </div>
    <div class="header-unique"><span class="icon">üåü</span>MoodBoost AI</div>
    <div class="subtext"><span style="color:#9ca3af;font-size:1.13em;">Wellbeing ‚Ä¢ Career ‚Ä¢ Music ‚Ä¢ Motivation</span></div>

    <div class="section-box">
      <div id="chat-history"></div>
      <form id="chat-form" class="input-row" autocomplete="off" style="margin-bottom:7px;">
        <input type="text" id="user-input" placeholder="Type your mood or thoughts..." required />
        <button type="submit"><span class="icon">üí¨</span>Send</button>
      </form>
    </div>

    <div class="section-box" id="history-section" style="display:none;">
      <h3><span class="icon">üìú</span>Your Chat History</h3>
      <div id="user-history"></div>
    </div>

    <div class="section-box">
      <h3><span class="icon">üöÄ</span>Career Recommendation</h3>
      <div class="input-row" style="margin-bottom:0;">
        <input type="text" id="interest-input" placeholder="Your interests (eg: AI, Design, Cloud)" />
        <button onclick="getCareer();return false;"><span class="icon">üéØ</span>Suggest</button>
      </div>
      <div id="career-result"></div>
    </div>

    <div class="section-box" style="text-align:center;">
      <h3><span class="icon">‚ú®</span>Daily Motivation</h3>
      <button onclick="getMotivation()" class="motiv-btn">Inspire Me!</button>
      <div id="motivational-quote"></div>
    </div>

    <div class="section-box">
      <h3><span class="icon">üéµ</span>Emotion to Music</h3>
      <div class="input-row" style="margin-bottom:0;">
        <input type="text" id="mood-input" placeholder="Enter mood (happy, sad, ...)" />
        <button onclick="getMusic();return false;"><span class="icon">üé∂</span>Get Music</button>
      </div>
      <div id="music-result"></div>
    </div>

    <div class="section-box">
      <h3><span class="icon">üí™</span>Life & Love Support</h3>
      <select id="situation-select">
        <option value="">Select your situation...</option>
        <option value="love_failure">üíî Love Failure</option>
        <option value="job_rejection">üö´ Job Rejection</option>
        <option value="exam_failure">üìù Exam Failure</option>
        <option value="family_issues">üë®‚Äçüë©‚Äçüëß Family Issues</option>
        <option value="financial_stress">üí∞ Financial Stress</option>
        <option value="loneliness">üòî Loneliness</option>
      </select>
      <button onclick="getLifeSupport()" style="width:100%; padding:12px; background:linear-gradient(90deg, #7c5cde 0%, #60a5fa 100%); color:#fff; font-weight:700; border:none; border-radius:13px; cursor:pointer; font-size:1.12em;">
        Get Support
      </button>
      <div id="support-result"></div>
    </div>
  </div>
  <script>
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');
    const chatHistory = document.getElementById('chat-history');

    window.onload = async function() {
      try {
        const res = await fetch('http://127.0.0.1:5000/check-auth', {credentials: 'include'});
        const data = await res.json();
        if(data.logged_in) {
          document.getElementById('username-display').textContent = data.username;
          document.getElementById('logout-btn').style.display = 'block';
          loadHistory();
        }
      } catch(e) {
        console.log('Auth check failed');
      }
    };

    async function loadHistory() {
      try {
        const res = await fetch('http://127.0.0.1:5000/history', {credentials: 'include'});
        const data = await res.json();
        if(data.history && data.history.length > 0) {
          document.getElementById('history-section').style.display = 'block';
          let html = '';
          data.history.forEach(h => {
            html += `<div class="history-item">
              <strong>You:</strong> ${h.message}<br>
              <strong>AI:</strong> ${h.reply}<br>
              <span class="history-time">${h.timestamp}</span>
            </div>`;
          });
          document.getElementById('user-history').innerHTML = html;
        }
      } catch(e) {
        console.log('History load failed');
      }
    }

    chatForm.addEventListener('submit', async function(event) {
      event.preventDefault();
      const message = userInput.value;
      chatHistory.innerHTML += `<div class="bubble-box"><span class="chat-you">You:</span> ${message}</div>`;
      userInput.value = '';
      try {
        const res = await fetch('http://127.0.0.1:5000/chatbot', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ message })
        });
        const data = await res.json();
        chatHistory.innerHTML += `<div class="bubble-box"><span class="chat-ai">MoodBoost AI:</span> ${data.reply}</div>`;
        chatHistory.scrollTop = chatHistory.scrollHeight;
        loadHistory();
      } catch (err) {
        chatHistory.innerHTML += `<div style="color:red"><b>Error:</b> ${err.message}</div>`;
      }
    });

    async function getCareer() {
      const interests = document.getElementById('interest-input').value;
      if (!interests) { document.getElementById('career-result').innerHTML = "Please type something!"; return;}
      const res = await fetch('http://127.0.0.1:5000/career', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ interests })
      });
      const data = await res.json();
      document.getElementById('career-result').innerHTML =
        "Your ideal career: <b>" + data.career + "</b>";
    }

    async function getMotivation() {
      try {
        const res = await fetch('http://127.0.0.1:5000/motivational');
        const data = await res.json();
        document.getElementById('motivational-quote').innerHTML = "üåà " + data.quote;
      } catch(e) {
        document.getElementById('motivational-quote').innerText = "Could not fetch quote!";
      }
    }

    async function getMusic() {
      const mood = document.getElementById('mood-input').value;
      if (!mood) { document.getElementById('music-result').innerHTML = "Please type a mood!"; return;}
      const res = await fetch('http://127.0.0.1:5000/music', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ mood })
      });
      const data = await res.json();
      let html = "<ul>";
      for(const song of data.playlist) html += `<li>üéµ ${song}</li>`;
      html += "</ul>";
      document.getElementById('music-result').innerHTML = html;
    }

    async function getLifeSupport() {
      const situation = document.getElementById('situation-select').value;
      if (!situation) {
        document.getElementById('support-result').innerHTML = "Please select a situation!";
        return;
      }
      const res = await fetch('http://127.0.0.1:5000/life-support', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ situation })
      });
      const data = await res.json();
      
      let html = `<p>${data.message}</p><p style="font-weight:600; color:#60a5fa; margin-bottom:8px;">Action Steps:</p><ul>`;
      data.steps.forEach(step => {
        html += `<li>${step}</li>`;
      });
      html += `</ul>`;
      document.getElementById('support-result').innerHTML = html;
    }

    async function logout() {
      await fetch('http://127.0.0.1:5000/logout', {method: 'POST', credentials: 'include'});
      window.location.href = 'login.html';
    }
  </script>
</body>
</html>
